FROM ubuntu:20.04

# Install V2Ray dependencies
RUN apt-get update && apt-get install -y \
    curl \
    sudo \
    ca-certificates

# Install V2Ray
RUN curl -L https://github.com/v2fly/v2ray-core/releases/download/v5.29.3/v2ray-linux-amd64-v5.29.3.tar.gz -o /tmp/v2ray.tar.gz && \
    tar -xvf /tmp/v2ray.tar.gz -C /tmp && \
    mv /tmp/v2ray-linux-amd64-v5.29.3 /usr/local/v2ray && \
    rm /tmp/v2ray.tar.gz

# Expose the necessary port for WebSocket
EXPOSE 80

# Copy configuration file (ensure it's in the same folder as Dockerfile)
COPY config.json /etc/v2ray/config.json

# Start V2Ray
CMD ["/usr/local/v2ray/v2ray", "-config", "/etc/v2ray/config.json"]
